/* Comando /confirmpublicidad */
var lang = User.getProperty("language") || "en";

var messages = {
    es: {
        notRegistered: "âš ï¸ Â¡AtenciÃ³n! Primero debes registrarte usando /register ğŸ“",
        adPointsGained: "ğŸ¯ Â¡Has ganado %d puntos por visitar la publicidad! ğŸ‰ğŸ’°\n\nğŸ”½ Â¿QuÃ© te gustarÃ­a hacer a continuaciÃ³n?",
        noActiveAd: "âŒ No tienes ninguna publicidad activa.\n\nğŸ” Usa /publicidad para comenzar y ganar puntos ğŸ“¢.",
        backToMenu: "ğŸ”™ Volver al MenÃº",
        visitAnotherAd: "ğŸ” Visitar otra publicidad"
    },
    en: {
        notRegistered: "âš ï¸ Attention! First, you must register using /register ğŸ“",
        adPointsGained: "ğŸ¯ You have earned %d points for visiting the advertisement! ğŸ‰ğŸ’°\n\nğŸ”½ What would you like to do next?",
        noActiveAd: "âŒ You have no active advertisement visit.\n\nğŸ” Use /publicidad to start and earn points ğŸ“¢.",
        backToMenu: "ğŸ”™ Back to Menu",
        visitAnotherAd: "ğŸ” Visit another advertisement"
    },
    ru: {
        notRegistered: "âš ï¸ Ğ’Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ! Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞ¹Ñ‚ĞµÑÑŒ, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ /register ğŸ“",
        adPointsGained: "ğŸ¯ Ğ’Ñ‹ Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ»Ğ¸ %d Ğ¾Ñ‡ĞºĞ¾Ğ² Ğ·Ğ° Ğ¿Ğ¾ÑĞµÑ‰ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞºĞ»Ğ°Ğ¼Ñ‹! ğŸ‰ğŸ’°\n\nğŸ”½ Ğ§Ñ‚Ğ¾ Ğ±Ñ‹ Ğ²Ñ‹ Ñ…Ğ¾Ñ‚ĞµĞ»Ğ¸ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ´Ğ°Ğ»ÑŒÑˆĞµ?",
        noActiveAd: "âŒ Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ¸Ğ·Ğ¸Ñ‚Ğ° Ñ€ĞµĞºĞ»Ğ°Ğ¼Ñ‹.\n\nğŸ” Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ /publicidad, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ Ğ¸ Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ğ±Ğ°Ğ»Ğ»Ñ‹ ğŸ“¢.",
        backToMenu: "ğŸ”™ Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ Ğ² Ğ¼ĞµĞ½Ñ",
        visitAnotherAd: "ğŸ” ĞŸĞ¾ÑĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ´Ñ€ÑƒĞ³ÑƒÑ Ñ€ĞµĞºĞ»Ğ°Ğ¼Ñƒ"
    },
    hi: {
        notRegistered: "âš ï¸ à¤§à¥à¤¯à¤¾à¤¨ à¤¦à¥‡à¤‚! à¤ªà¤¹à¤²à¥‡ à¤†à¤ªà¤•à¥‹ /register ğŸ“ à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¤•à¥‡ à¤ªà¤‚à¤œà¥€à¤•à¤°à¤£ à¤•à¤°à¤¨à¤¾ à¤¹à¥‹à¤—à¤¾",
        adPointsGained: "ğŸ¯ à¤†à¤ªà¤¨à¥‡ à¤µà¤¿à¤œà¥à¤à¤¾à¤ªà¤¨ à¤¦à¥‡à¤–à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ %d à¤…à¤‚à¤• à¤•à¤®à¤¾à¤ à¤¹à¥ˆà¤‚! ğŸ‰ğŸ’°\n\nğŸ”½ à¤…à¤¬ à¤†à¤ª à¤•à¥à¤¯à¤¾ à¤•à¤°à¤¨à¤¾ à¤šà¤¾à¤¹à¥‡à¤‚à¤—à¥‡?",
        noActiveAd: "âŒ à¤†à¤ªà¤•à¥‡ à¤ªà¤¾à¤¸ à¤•à¥‹à¤ˆ à¤¸à¤•à¥à¤°à¤¿à¤¯ à¤µà¤¿à¤œà¥à¤à¤¾à¤ªà¤¨ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤\n\nğŸ” /publicidad à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¥‡à¤‚ à¤”à¤° à¤…à¤‚à¤• à¤•à¤®à¤¾à¤à¤‚ ğŸ“¢",
        backToMenu: "ğŸ”™ à¤®à¥‡à¤¨à¥‚ à¤®à¥‡à¤‚ à¤µà¤¾à¤ªà¤¸ à¤œà¤¾à¤à¤‚",
        visitAnotherAd: "ğŸ” à¤¦à¥‚à¤¸à¤°à¤¾ à¤µà¤¿à¤œà¥à¤à¤¾à¤ªà¤¨ à¤¦à¥‡à¤–à¥‡à¤‚"
    },
    zh: {
        notRegistered: "âš ï¸ æ³¨æ„ï¼æ‚¨å¿…é¡»å…ˆä½¿ç”¨ /register ğŸ“ è¿›è¡Œæ³¨å†Œ",
        adPointsGained: "ğŸ¯ æ‚¨å·²è·å¾— %d ç‚¹æ•°ç”¨äºè§‚çœ‹å¹¿å‘Šï¼ğŸ‰ğŸ’°\n\nğŸ”½ æ¥ä¸‹æ¥æ‚¨æƒ³åšä»€ä¹ˆï¼Ÿ",
        noActiveAd: "âŒ æ‚¨å½“å‰æ²¡æœ‰å¯è®¿é—®çš„å¹¿å‘Šã€‚\n\nğŸ” ä½¿ç”¨ /publicidad å¼€å§‹å¹¶èµšå–ç§¯åˆ† ğŸ“¢ã€‚",
        backToMenu: "ğŸ”™ è¿”å›èœå•",
        visitAnotherAd: "ğŸ” è®¿é—®å¦ä¸€ä¸ªå¹¿å‘Š"
    },
    ja: {
        notRegistered: "âš ï¸ æ³¨æ„ï¼ã¾ãš /register ğŸ“ ã‚’ä½¿ç”¨ã—ã¦ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™",
        adPointsGained: "ğŸ¯ åºƒå‘Šã‚’è¨ªã‚Œã¦ %d ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ã—ã¾ã—ãŸï¼ğŸ‰ğŸ’°\n\nğŸ”½ æ¬¡ã«ä½•ã‚’ã—ã¾ã™ã‹ï¼Ÿ",
        noActiveAd: "âŒ ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªåºƒå‘Šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚\n\nğŸ” /publicidad ã‚’ä½¿ç”¨ã—ã¦é–‹å§‹ã—ã€ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ã—ã¾ã—ã‚‡ã† ğŸ“¢ã€‚",
        backToMenu: "ğŸ”™ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹",
        visitAnotherAd: "ğŸ” åˆ¥ã®åºƒå‘Šã‚’è¨ªå•"
    },
    ar: {
        notRegistered: "âš ï¸ Ø§Ù†ØªØ¨Ø§Ù‡! ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… /register ğŸ“",
        adPointsGained: "ğŸ¯ Ù„Ù‚Ø¯ ÙƒØ³Ø¨Øª %d Ù†Ù‚Ø·Ø© Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†! ğŸ‰ğŸ’°\n\nğŸ”½ Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªÙØ¹Ù„ Ø¨Ø¹Ø¯ Ø°Ù„ÙƒØŸ",
        noActiveAd: "âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø¥Ø¹Ù„Ø§Ù† Ù†Ø´Ø·.\n\nğŸ” Ø§Ø³ØªØ®Ø¯Ù… /publicidad Ù„Ø¨Ø¯Ø¡ Ø§Ù„ÙƒØ³Ø¨ ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø· ğŸ“¢.",
        backToMenu: "ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©",
        visitAnotherAd: "ğŸ” Ø²ÙŠØ§Ø±Ø© Ø¥Ø¹Ù„Ø§Ù† Ø¢Ø®Ø±"
    }
};

var userData = Bot.getProperty("user_" + user.telegramid);
if (!userData) {
    Bot.sendMessage(messages[lang].notRegistered);
    return;
}

// Verificar si hay una visita de publicidad activa
if (!User.getProperty("ad_in_progress")) {
    Bot.sendMessage(messages[lang].noActiveAd);
    return;
}

// Otorgar siempre 50 puntos
var earnedPoints = 50;

userData.points = (userData.points || 0) + earnedPoints;
Bot.setProperty("user_" + user.telegramid, userData, "json");

var keyboard = [
    [{ title: messages[lang].backToMenu, command: "/start" }],
    [{ title: messages[lang].visitAnotherAd, command: "/publicidad" }]
];

Bot.sendInlineKeyboard(keyboard, messages[lang].adPointsGained.replace("%d", earnedPoints));

// Resetear la propiedad de visita de publicidad
User.setProperty("ad_in_progress", false, "boolean");
