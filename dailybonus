var lang = User.getProperty("language") || "en"; // ğŸŒ Idioma del usuario, por defecto inglÃ©s

// Mensajes en diferentes idiomas
var messages = {
    es: {
        notRegistered: "âš ï¸ Primero regÃ­strate usando /register.",
        bonusReceived: "Â¡Felicidades! ğŸ‰ Has recibido %d puntos como Daily Bonus. Â¡Sigue asÃ­!",
        bonusCooldown: "Ya has reclamado tu Daily Bonus. Por favor, espera %d horas, %d minutos y %d segundos para volver a reclamar."
    },
    en: {
        notRegistered: "âš ï¸ First, you must register using /register.",
        bonusReceived: "Congratulations! ğŸ‰ You have received %d points as a Daily Bonus. Keep it up!",
        bonusCooldown: "You have already claimed your Daily Bonus. Please wait %d hours, %d minutes and %d seconds to claim again."
    },
    ru: {
        notRegistered: "âš ï¸ Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞ¹Ñ‚ĞµÑÑŒ, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ /register.",
        bonusReceived: "ĞŸĞ¾Ğ·Ğ´Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼! ğŸ‰ Ğ’Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ¸ %d Ğ¾Ñ‡ĞºĞ¾Ğ² Ğ² ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğµ Daily Bonus. Ğ¢Ğ°Ğº Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ!",
        bonusCooldown: "Ğ’Ñ‹ ÑƒĞ¶Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ»Ğ¸ ÑĞ²Ğ¾Ğ¹ Daily Bonus. ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ %d Ñ‡Ğ°ÑĞ¾Ğ², %d Ğ¼Ğ¸Ğ½ÑƒÑ‚ Ğ¸ %d ÑĞµĞºÑƒĞ½Ğ´, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞµĞ³Ğ¾ ÑĞ½Ğ¾Ğ²Ğ°."
    },
    hi: {
        notRegistered: "âš ï¸ à¤ªà¤¹à¤²à¥‡ /register à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¤•à¥‡ à¤°à¤œà¤¿à¤¸à¥à¤Ÿà¤° à¤•à¤°à¥‡à¤‚à¥¤",
        bonusReceived: "à¤¬à¤§à¤¾à¤ˆ à¤¹à¥‹! ğŸ‰ à¤†à¤ªà¤¨à¥‡ %d à¤ªà¥à¤µà¤¾à¤‡à¤‚à¤Ÿà¥à¤¸ à¤•à¥‡ à¤°à¥‚à¤ª à¤®à¥‡à¤‚ Daily Bonus à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤¿à¤¯à¤¾à¥¤ à¤à¤¸à¥‡ à¤¹à¥€ à¤œà¤¾à¤°à¥€ à¤°à¤–à¥‡à¤‚!",
        bonusCooldown: "à¤†à¤ªà¤¨à¥‡ à¤ªà¤¹à¤²à¥‡ à¤¹à¥€ à¤…à¤ªà¤¨à¤¾ Daily Bonus à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤° à¤²à¤¿à¤¯à¤¾ à¤¹à¥ˆà¥¤ à¤•à¥ƒà¤ªà¤¯à¤¾ %d à¤˜à¤‚à¤Ÿà¥‡, %d à¤®à¤¿à¤¨à¤Ÿ à¤”à¤° %d à¤¸à¥‡à¤•à¤‚à¤¡ à¤•à¤¾ à¤‡à¤‚à¤¤à¤œà¤¾à¤° à¤•à¤°à¥‡à¤‚, à¤«à¤¿à¤° à¤¸à¥‡ à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤à¥¤"
    },
    zh: { // Chino simplificado (ç®€ä½“ä¸­æ–‡)
        notRegistered: "âš ï¸ è¯·å…ˆä½¿ç”¨ /register è¿›è¡Œæ³¨å†Œã€‚",
        bonusReceived: "ğŸ‰ æ­å–œï¼ä½ å·²è·å¾— %d ç‚¹ä½œä¸ºæ¯æ—¥å¥–åŠ±ã€‚ç»§ç»­åŠ æ²¹ï¼",
        bonusCooldown: "ä½ å·²é¢†å–æ¯æ—¥å¥–åŠ±ã€‚è¯·ç­‰å¾… %d å°æ—¶ %d åˆ†é’Ÿ %d ç§’åå†é¢†å–ã€‚"
    },
    ja: { // JaponÃ©s (æ—¥æœ¬èª)
        notRegistered: "âš ï¸ æœ€åˆã« /register ã‚’ä½¿ç”¨ã—ã¦ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚",
        bonusReceived: "ğŸ‰ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼%d ãƒã‚¤ãƒ³ãƒˆã®ãƒ‡ã‚¤ãƒªãƒ¼ãƒœãƒ¼ãƒŠã‚¹ã‚’ç²å¾—ã—ã¾ã—ãŸã€‚é ‘å¼µã£ã¦ãã ã•ã„ï¼",
        bonusCooldown: "ãƒ‡ã‚¤ãƒªãƒ¼ãƒœãƒ¼ãƒŠã‚¹ã¯ã™ã§ã«å—ã‘å–ã‚Šæ¸ˆã¿ã§ã™ã€‚%d æ™‚é–“ %d åˆ† %d ç§’ å¾…ã£ã¦ã‹ã‚‰å†åº¦å—ã‘å–ã£ã¦ãã ã•ã„ã€‚"
    },
    ar: { // Ãrabe (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)
        notRegistered: "âš ï¸ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… /register.",
        bonusReceived: "ğŸ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ù„Ù‚Ø¯ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ %d Ù†Ù‚Ø·Ø© ÙƒÙ…ÙƒØ§ÙØ£Ø© ÙŠÙˆÙ…ÙŠØ©. Ø§Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„ØªÙ‚Ø¯Ù…!",
        bonusCooldown: "Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© Ø¨Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± %d Ø³Ø§Ø¹Ø© Ùˆ %d Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ %d Ø«Ø§Ù†ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø·Ø§Ù„Ø¨Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰."
    }
};

var userData = Bot.getProperty("user_" + user.telegramid);
if (!userData) {
    Bot.sendMessage(messages[lang].notRegistered);
    return;
}

var lastBonusTime = User.getProperty("last_daily_bonus_" + user.telegramid);
var currentTime = new Date().getTime();
var bonusCooldown = 24 * 60 * 60 * 1000; // 24 horas en milisegundos

if (!lastBonusTime || (currentTime - lastBonusTime >= bonusCooldown)) {
    var bonusPoints = Math.floor(Math.random() * 50) + 1; // Bonus aleatorio entre 1 y 50 puntos
    userData.points = (userData.points || 0) + bonusPoints; // Sumar puntos
    Bot.setProperty("user_" + user.telegramid, userData, "json");
    User.setProperty("last_daily_bonus_" + user.telegramid, currentTime, "integer");

    var message = messages[lang].bonusReceived.replace("%d", bonusPoints);

    // Teclado inline para volver al menÃº
    var keyboard = [[{ title: getButtonText("backToMenu"), command: "/start" }]];

    // Enviar el mensaje del bonus junto con el teclado
    Bot.sendInlineKeyboard(keyboard, message);
} else {
    // Calcular tiempo restante para poder reclamar de nuevo
    var remainingTime = bonusCooldown - (currentTime - lastBonusTime);
    var hours = Math.floor(remainingTime / (1000 * 60 * 60));
    var minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);

    // Formar el mensaje de cooldown usando los valores calculados
    var cooldownMessage = messages[lang].bonusCooldown.replace("%d", hours).replace("%d", minutes).replace("%d", seconds);

    // Teclado inline para volver al menÃº
    var keyboard = [[{ title: getButtonText("backToMenu"), command: "/start" }]];

    Bot.sendInlineKeyboard(keyboard, cooldownMessage);
}

// FunciÃ³n para obtener el texto del botÃ³n segÃºn el idioma
function getButtonText(buttonKey) {
    var buttonTexts = {
        backToMenu: {
            es: "ğŸ”™ Volver al MenÃº",
            en: "ğŸ”™ Back to Menu",
            ru: "ğŸ”™ Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ Ğ² Ğ¼ĞµĞ½Ñ",
            hi: "ğŸ”™ à¤®à¥‡à¤¨à¥‚ à¤ªà¤° à¤µà¤¾à¤ªà¤¸ à¤œà¤¾à¤à¤‚",
            zh: "ğŸ”™ è¿”å›èœå•", // Chino simplificado
            ja: "ğŸ”™ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹", // JaponÃ©s
            ar: "ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©" // Ãrabe
        }
    };
    return buttonTexts[buttonKey][lang] || buttonTexts[buttonKey].es; // Si no encuentra el idioma, usa espaÃ±ol por defecto
}
