if (message == "/reRegister") {
    var lang = User.getProperty("language") || "en"; // Idioma predeterminado: inglÃ©s

    // ğŸ“¢ Mensajes en diferentes idiomas
    var messages = {
        es: {
            alreadyRegistered: "âš ï¸ Ya estÃ¡s registrado.",
            registrationSuccess: "âœ… Registro exitoso.",
            nextAction: "ğŸ¤” Â¿QuÃ© te gustarÃ­a hacer a continuaciÃ³n?",
            referrerPoints: "ğŸ‰ Â¡Tu referidor ha ganado {points} puntos!",
            referredSuccess: "ğŸ‰ Â¡Te has registrado con Ã©xito a travÃ©s de un referidor!"
        },
        en: {
            alreadyRegistered: "âš ï¸ You are already registered.",
            registrationSuccess: "âœ… Registration successful.",
            nextAction: "ğŸ¤” What would you like to do next?",
            referrerPoints: "ğŸ‰ Your referrer has earned {points} points!",
            referredSuccess: "ğŸ‰ You have successfully registered through a referrer!"
        },
        ru: {
            alreadyRegistered: "âš ï¸ Ğ’Ñ‹ ÑƒĞ¶Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹.",
            registrationSuccess: "âœ… Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾.",
            nextAction: "ğŸ¤” Ğ§Ñ‚Ğ¾ Ğ²Ñ‹ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ´Ğ°Ğ»ÑŒÑˆĞµ?",
            referrerPoints: "ğŸ‰ Ğ’Ğ°Ñˆ Ñ€ĞµÑ„ĞµÑ€ĞµÑ€ Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» {points} Ğ¾Ñ‡ĞºĞ¾Ğ²!",
            referredSuccess: "ğŸ‰ Ğ’Ñ‹ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ¸ÑÑŒ Ñ‡ĞµÑ€ĞµĞ· Ñ€ĞµÑ„ĞµÑ€ĞµÑ€Ğ°!"
        },
        hi: { // Hindi ğŸ‡®ğŸ‡³
            alreadyRegistered: "âš ï¸ à¤†à¤ª à¤ªà¤¹à¤²à¥‡ à¤¸à¥‡ à¤¹à¥€ à¤ªà¤‚à¤œà¥€à¤•à¥ƒà¤¤ à¤¹à¥ˆà¤‚à¥¤",
            registrationSuccess: "âœ… à¤ªà¤‚à¤œà¥€à¤•à¤°à¤£ à¤¸à¤«à¤² à¤¹à¥à¤†à¥¤",
            nextAction: "ğŸ¤” à¤†à¤ª à¤†à¤—à¥‡ à¤•à¥à¤¯à¤¾ à¤•à¤°à¤¨à¤¾ à¤šà¤¾à¤¹à¥‡à¤‚à¤—à¥‡?",
            referrerPoints: "ğŸ‰ à¤†à¤ªà¤•à¥‡ à¤°à¥‡à¤«à¤°à¤° à¤¨à¥‡ {points} à¤…à¤‚à¤• à¤…à¤°à¥à¤œà¤¿à¤¤ à¤•à¤¿à¤ à¤¹à¥ˆà¤‚!",
            referredSuccess: "ğŸ‰ à¤†à¤ªà¤¨à¥‡ à¤à¤• à¤°à¥‡à¤«à¤°à¤° à¤•à¥‡ à¤®à¤¾à¤§à¥à¤¯à¤® à¤¸à¥‡ à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤ªà¤‚à¤œà¥€à¤•à¤°à¤£ à¤•à¤¿à¤¯à¤¾ à¤¹à¥ˆ!"
        },
        zh: { // Chino ğŸ‡¨ğŸ‡³
            alreadyRegistered: "âš ï¸ æ‚¨å·²ç»æ³¨å†Œã€‚",
            registrationSuccess: "âœ… æ³¨å†ŒæˆåŠŸã€‚",
            nextAction: "ğŸ¤” æ¥ä¸‹æ¥æ‚¨æƒ³åšä»€ä¹ˆï¼Ÿ",
            referrerPoints: "ğŸ‰ æ‚¨çš„æ¨èäººè·å¾—äº† {points} ç§¯åˆ†ï¼",
            referredSuccess: "ğŸ‰ æ‚¨å·²é€šè¿‡æ¨èäººæˆåŠŸæ³¨å†Œï¼"
        },
        ja: { // JaponÃ©s ğŸ‡¯ğŸ‡µ
            alreadyRegistered: "âš ï¸ ã‚ãªãŸã¯ã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚",
            registrationSuccess: "âœ… ç™»éŒ²æˆåŠŸã€‚",
            nextAction: "ğŸ¤” æ¬¡ã«ä½•ã‚’ã—ãŸã„ã§ã™ã‹ï¼Ÿ",
            referrerPoints: "ğŸ‰ ã‚ãªãŸã®ç´¹ä»‹è€…ã¯ {points} ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ã—ã¾ã—ãŸï¼",
            referredSuccess: "ğŸ‰ ã‚ãªãŸã¯ç´¹ä»‹è€…ã‚’é€šã˜ã¦æˆåŠŸè£ã«ç™»éŒ²ã—ã¾ã—ãŸï¼"
        },
        ar: { // Ãrabe ğŸ‡¸ğŸ‡¦
            alreadyRegistered: "âš ï¸ Ø£Ù†Øª Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„.",
            registrationSuccess: "âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­.",
            nextAction: "ğŸ¤” Ù…Ø§Ø°Ø§ ØªØ±ØºØ¨ ÙÙŠ ÙØ¹Ù„Ù‡ Ø¨Ø¹Ø¯ØŸ",
            referrerPoints: "ğŸ‰ Ù„Ù‚Ø¯ Ø­ØµÙ„ Ù…Ø­Ø§Ù„Ùƒ Ø¹Ù„Ù‰ {points} Ù†Ù‚Ø§Ø·!",
            referredSuccess: "ğŸ‰ Ù„Ù‚Ø¯ Ù‚Ù…Øª Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ Ø¹Ø¨Ø± Ù…Ø­Ø§Ù„!"
        }
    };

    // ğŸ“Œ Obtener datos del usuario
    var userData = Bot.getProperty("user_" + user.telegramid);

    if (userData) {
        // Borrar los datos del usuario para permitir un nuevo registro
        Bot.setProperty("user_" + user.telegramid, null); 
        Bot.sendMessage(messages[lang].alreadyRegistered); // Si el usuario ya estÃ¡ registrado, eliminar datos y permitir nuevo registro
    } 

    // Si no estÃ¡ registrado o despuÃ©s de borrar los datos, registrar nuevamente
    var username = user.username ? "@" + user.username : "Usuario_" + user.telegramid;
    var newUser = {
        username: username,
        points: 0,
        referrals: 0,
        links: []
    };

    // Manejo de referidos
    Libs.ReferralLib.currentUser.track({
        onAttractedByUser: function (refUser) {
            Bot.sendMessage(messages[lang].referrerPoints.replace("{points}", 50));

            // ğŸ“Œ Sumar puntos al referidor si estÃ¡ registrado
            var referrerData = Bot.getProperty("user_" + refUser.chatId);
            if (referrerData) {
                referrerData.points += 50;
                referrerData.referrals += 1;
                Bot.setProperty("user_" + refUser.chatId, referrerData, "json");
            } else {
                Bot.sendMessage(messages[lang].referredSuccess); // Si el referidor no estÃ¡ registrado
            }
        }
    });

    // Guardar el nuevo usuario
    Bot.setProperty("user_" + user.telegramid, newUser, "json");

    // Actualizar la lista de usuarios evitando duplicados
    var allUsers = Bot.getProperty("all_users", []);
    if (!allUsers.includes(user.telegramid)) {
        allUsers.push(user.telegramid);
        Bot.setProperty("all_users", allUsers, "json");
    }

    Bot.sendMessage(messages[lang].registrationSuccess); // ConfirmaciÃ³n de registro exitoso

    // ğŸ›  Teclado inline con opciones
    var keyboard = [
        [{ title: lang === "es" ? "â• Agregar Enlace" : (lang === "hi" ? "â• à¤²à¤¿à¤‚à¤• à¤œà¥‹à¤¡à¤¼à¥‡à¤‚" : (lang === "zh" ? "â• æ·»åŠ é“¾æ¥" : (lang === "ja" ? "â• ãƒªãƒ³ã‚¯ã‚’è¿½åŠ " : (lang === "ar" ? "â• Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø·" : "â• Add Link")))), command: "/addlink" }],
        [{ title: lang === "es" ? "ğŸ† Ver Ranking" : (lang === "hi" ? "ğŸ† à¤°à¥ˆà¤‚à¤•à¤¿à¤‚à¤— à¤¦à¥‡à¤–à¥‡à¤‚" : (lang === "zh" ? "ğŸ† æŸ¥çœ‹æ’å" : (lang === "ja" ? "ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¦‹ã‚‹" : (lang === "ar" ? "ğŸ† Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ØªØ±ØªÙŠØ¨" : "ğŸ† View Ranking")))), command: "/rankings" }],
        [{ title: lang === "es" ? "ğŸ’ Mis Puntos" : (lang === "hi" ? "ğŸ’ à¤®à¥‡à¤°à¥‡ à¤…à¤‚à¤•" : (lang === "zh" ? "ğŸ’ æˆ‘çš„ç§¯åˆ†" : (lang === "ja" ? "ğŸ’ ç§ã®ãƒã‚¤ãƒ³ãƒˆ" : (lang === "ar" ? "ğŸ’ Ù†Ù‚Ø§Ø·ÙŠ" : "ğŸ’ My Points")))), command: "/checkpoints" }],
        [{ title: lang === "es" ? "ğŸ”™ Volver al MenÃº" : (lang === "hi" ? "ğŸ”™ à¤®à¥‡à¤¨à¥‚ à¤ªà¤° à¤µà¤¾à¤ªà¤¸ à¤œà¤¾à¤à¤‚" : (lang === "zh" ? "ğŸ”™ è¿”å›èœå•" : (lang === "ja" ? "ğŸ”™ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹" : (lang === "ar" ? "ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©" : "ğŸ”™ Back to Menu")))), command: "/start" }]
    ];

    // Enviar el teclado con un mensaje de acciÃ³n
    Bot.sendInlineKeyboard(keyboard, messages[lang].nextAction);
}
