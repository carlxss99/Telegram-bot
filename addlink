// /addlink
var lang = User.getProperty("language") || "en"; // Obtener el idioma del usuario, predeterminado a espaÃ±ol

// Mensajes en diferentes idiomas
var messages = {
  es: {
    notRegistered: "âš ï¸ Â¡Primero regÃ­strate usando /register! ğŸ‘¤",
    linkAdded: "âœ… Â¡Enlace agregado exitosamente! ğŸ‰",
    invalidLink: "âŒ Por favor, proporciona un enlace vÃ¡lido. Ejemplo: usa el comando /addlink + tu enlace https://t.me/... (solo enlaces de Telegram vÃ¡lidos). ğŸ”—",
    nextAction: "ğŸ‘‰ Â¿QuÃ© te gustarÃ­a hacer a continuaciÃ³n?",
    linkLimitReached: "ğŸš« No puedes agregar mÃ¡s de 5 enlaces. Â¡LÃ­mite alcanzado! ğŸ”’"
  },
  en: {
    notRegistered: "âš ï¸ First, register using /register! ğŸ‘¤",
    linkAdded: "âœ… Link added successfully! ğŸ‰",
    invalidLink: "âŒ Please provide a valid link. Example: use the command /addlink + your link https://t.me/... (only valid Telegram links). ğŸ”—",
    nextAction: "ğŸ‘‰ What would you like to do next?",
    linkLimitReached: "ğŸš« You cannot add more than 5 links. Limit reached! ğŸ”’"
  },
  ru: {
    notRegistered: "âš ï¸ Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞ¹Ñ‚ĞµÑÑŒ, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ /register! ğŸ‘¤",
    linkAdded: "âœ… Ğ¡ÑÑ‹Ğ»ĞºĞ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ°! ğŸ‰",
    invalidLink: "âŒ ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½ÑƒÑ ÑÑÑ‹Ğ»ĞºÑƒ. ĞŸÑ€Ğ¸Ğ¼ĞµÑ€: Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ /addlink + Ğ²Ğ°ÑˆĞ° ÑÑÑ‹Ğ»ĞºĞ° https://t.me/... (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ ÑÑÑ‹Ğ»ĞºĞ¸ Telegram). ğŸ”—",
    nextAction: "ğŸ‘‰ Ğ§Ñ‚Ğ¾ Ğ²Ñ‹ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ´Ğ°Ğ»ÑŒÑˆĞµ?",
    linkLimitReached: "ğŸš« Ğ’Ñ‹ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ±Ğ¾Ğ»ĞµĞµ 5 ÑÑÑ‹Ğ»Ğ¾Ğº. Ğ›Ğ¸Ğ¼Ğ¸Ñ‚ Ğ´Ğ¾ÑÑ‚Ğ¸Ğ³Ğ½ÑƒÑ‚! ğŸ”’"
  },
  hi: {
    notRegistered: "âš ï¸ à¤ªà¤¹à¤²à¥‡ /register à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¤•à¥‡ à¤ªà¤‚à¤œà¥€à¤•à¤°à¤£ à¤•à¤°à¥‡à¤‚! ğŸ‘¤",
    linkAdded: "âœ… à¤²à¤¿à¤‚à¤• à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤œà¥‹à¤¡à¤¼à¤¾ à¤—à¤¯à¤¾! ğŸ‰",
    invalidLink: "âŒ à¤•à¥ƒà¤ªà¤¯à¤¾ à¤à¤• à¤®à¤¾à¤¨à¥à¤¯ à¤²à¤¿à¤‚à¤• à¤ªà¥à¤°à¤¦à¤¾à¤¨ à¤•à¤°à¥‡à¤‚à¥¤ à¤‰à¤¦à¤¾à¤¹à¤°à¤£: à¤•à¤®à¤¾à¤‚à¤¡ /addlink + à¤†à¤ªà¤•à¤¾ à¤²à¤¿à¤‚à¤• https://t.me/... (à¤•à¥‡à¤µà¤² à¤µà¥ˆà¤§ à¤Ÿà¥‡à¤²à¥€à¤—à¥à¤°à¤¾à¤® à¤²à¤¿à¤‚à¤•)à¥¤ ğŸ”—",
    nextAction: "ğŸ‘‰ à¤…à¤—à¤²à¤¾ à¤†à¤ª à¤•à¥à¤¯à¤¾ à¤•à¤°à¤¨à¤¾ à¤šà¤¾à¤¹à¥‡à¤‚à¤—à¥‡?",
    linkLimitReached: "ğŸš« à¤†à¤ª 5 à¤¸à¥‡ à¤…à¤§à¤¿à¤• à¤²à¤¿à¤‚à¤• à¤¨à¤¹à¥€à¤‚ à¤œà¥‹à¤¡à¤¼ à¤¸à¤•à¤¤à¥‡à¥¤ à¤¸à¥€à¤®à¤¾ à¤ªà¥‚à¤°à¥€ à¤¹à¥‹ à¤—à¤ˆ! ğŸ”’"
  },
  zh: {
    notRegistered: "âš ï¸ è¯·å…ˆä½¿ç”¨ /register è¿›è¡Œæ³¨å†Œï¼ğŸ‘¤",
    linkAdded: "âœ… é“¾æ¥æ·»åŠ æˆåŠŸï¼ğŸ‰",
    invalidLink: "âŒ è¯·è¾“å…¥æœ‰æ•ˆçš„é“¾æ¥ã€‚ä¾‹å¦‚ï¼šä½¿ç”¨å‘½ä»¤ /addlink + ä½ çš„é“¾æ¥ https://t.me/...ï¼ˆä»…æ”¯æŒæœ‰æ•ˆçš„ Telegram é“¾æ¥ï¼‰ã€‚ğŸ”—",
    nextAction: "ğŸ‘‰ æ¥ä¸‹æ¥ä½ æƒ³åšä»€ä¹ˆï¼Ÿ",
    linkLimitReached: "ğŸš« ä½ ä¸èƒ½æ·»åŠ è¶…è¿‡ 5 ä¸ªé“¾æ¥ã€‚å·²è¾¾åˆ°ä¸Šé™ï¼ğŸ”’"
  },
  ja: {
    notRegistered: "âš ï¸ ã¾ãš /register ã‚’ä½¿ç”¨ã—ã¦ç™»éŒ²ã—ã¦ãã ã•ã„ï¼ğŸ‘¤",
    linkAdded: "âœ… ãƒªãƒ³ã‚¯ãŒæ­£å¸¸ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸï¼ğŸ‰",
    invalidLink: "âŒ æœ‰åŠ¹ãªãƒªãƒ³ã‚¯ã‚’æä¾›ã—ã¦ãã ã•ã„ã€‚ä¾‹: /addlink + ã‚ãªãŸã®ãƒªãƒ³ã‚¯ https://t.me/...ï¼ˆæœ‰åŠ¹ãª Telegram ãƒªãƒ³ã‚¯ã®ã¿ï¼‰ã€‚ğŸ”—",
    nextAction: "ğŸ‘‰ æ¬¡ã«ä½•ã‚’ã—ã¾ã™ã‹ï¼Ÿ",
    linkLimitReached: "ğŸš« 5 ã¤ä»¥ä¸Šã®ãƒªãƒ³ã‚¯ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ä¸Šé™ã«é”ã—ã¾ã—ãŸï¼ğŸ”’"
  },
  ar: {
    notRegistered: "âš ï¸ Ø£ÙˆÙ„Ø§Ù‹ØŒ Ù‚Ù… Ø¨Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… /register! ğŸ‘¤",
    linkAdded: "âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰",
    invalidLink: "âŒ ÙŠØ±Ø¬Ù‰ ØªÙˆÙÙŠØ± Ø±Ø§Ø¨Ø· ØµØ§Ù„Ø­. Ù…Ø«Ø§Ù„: Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ù…Ø± /addlink + Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ https://t.me/... (ÙÙ‚Ø· Ø±ÙˆØ§Ø¨Ø· ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„ØµØ§Ù„Ø­Ø©). ğŸ”—",
    nextAction: "ğŸ‘‰ Ù…Ø§Ø°Ø§ ØªØ±ØºØ¨ ÙÙŠ Ø§Ù„Ù‚ÙŠØ§Ù… Ø¨Ù‡ Ø¨Ø¹Ø¯ Ø°Ù„ÙƒØŸ",
    linkLimitReached: "ğŸš« Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ«Ø± Ù…Ù† 5 Ø±ÙˆØ§Ø¨Ø·. ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰! ğŸ”’"
  }
};

// ExpresiÃ³n regular para validar enlaces de Telegram, incluyendo enlaces con parÃ¡metros
const telegramLinkPattern = /^https:\/\/t\.me\/[A-Za-z0-9_-]+(?:\/[A-Za-z0-9_-]+)?(?:\?[\w=&-]+)*$/;

try {
  // Obtener los datos del usuario
  var userData = Bot.getProperty("user_" + user.telegramid) || { links: [] };

  // Comprobar si el usuario estÃ¡ registrado
  if (!userData.username) {
    Bot.sendMessage(messages[lang].notRegistered);
    return;
  }

  // Comprobar si el enlace es vÃ¡lido
  if (params && telegramLinkPattern.test(params)) {
    // Comprobar si el enlace ya estÃ¡ agregado
    if (userData.links.includes(params)) {
      Bot.sendMessage(messages[lang].invalidLink + " Este enlace ya estÃ¡ agregado. ğŸš«");
      return;
    }

    // Limitar a un mÃ¡ximo de 5 enlaces
    if (userData.links.length < 5) {
      userData.links.push(params); // Agregar el enlace
      Bot.setProperty("user_" + user.telegramid, userData, "json"); // Guardar los datos del usuario
      Bot.sendMessage(messages[lang].linkAdded);

      // Asegurarse de que el usuario estÃ© en all_users
      var allUsers = Bot.getProperty("all_users", []);
      if (!allUsers.includes(user.telegramid)) {
        allUsers.push(user.telegramid);
        Bot.setProperty("all_users", allUsers, "json");
      }
    } else {
      Bot.sendMessage(messages[lang].linkLimitReached);
    }
  } else {
    Bot.sendMessage(messages[lang].invalidLink);
  }

} catch (error) {
  Bot.sendMessage("âŒ OcurriÃ³ un error inesperado. IntÃ©ntalo nuevamente mÃ¡s tarde.");
  console.error("Error inesperado:", error); // Esto lo imprimirÃ¡ en la consola
}

// Crear teclado inline
var keyboard = [
  [{ title: lang === "es" ? "â• Agregar Otro Enlace" : (lang === "en" ? "â• Add Another Link" : (lang === "ru" ? "â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ´Ñ€ÑƒĞ³ÑƒÑ ÑÑÑ‹Ğ»ĞºÑƒ" : (lang === "hi" ? "â• à¤¦à¥‚à¤¸à¤°à¤¾ à¤²à¤¿à¤‚à¤• à¤œà¥‹à¤¡à¤¼à¥‡à¤‚" : (lang === "zh" ? "â• æ·»åŠ å¦ä¸€ä¸ªé“¾æ¥" : (lang === "ar" ? "â• Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¢Ø®Ø±" : "â• åˆ¥ã®ãƒªãƒ³ã‚¯ã‚’è¿½åŠ "))))), command: "/addlink" }],
  [{ title: lang === "es" ? "âŒ Eliminar Enlace" : (lang === "en" ? "âŒ Remove Link" : (lang === "ru" ? "âŒ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑÑ‹Ğ»ĞºÑƒ" : (lang === "hi" ? "âŒ à¤²à¤¿à¤‚à¤• à¤¹à¤Ÿà¤¾à¤à¤‚" : (lang === "zh" ? "âŒ åˆ é™¤é“¾æ¥" : (lang === "ar" ? "âŒ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø§Ø¨Ø·" : "âŒ ãƒªãƒ³ã‚¯ã‚’å‰Šé™¤"))))), command: "/removelink" }],
  [{ title: lang === "es" ? "ğŸ† Ver Ranking" : (lang === "en" ? "ğŸ† View Ranking" : (lang === "ru" ? "ğŸ† ĞŸĞ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³" : (lang === "hi" ? "ğŸ† à¤°à¥ˆà¤‚à¤•à¤¿à¤‚à¤— à¤¦à¥‡à¤–à¥‡à¤‚" : (lang === "zh" ? "ğŸ† æŸ¥çœ‹æ’å" : (lang === "ar" ? "ğŸ† Ø¹Ø±Ø¶ Ø§Ù„ØªØ±ØªÙŠØ¨" : "ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¦‹ã‚‹"))))), command: "/rankings" }],
  [{ title: lang === "es" ? "ğŸ”™ Volver al MenÃº" : (lang === "en" ? "ğŸ”™ Back to Menu" : (lang === "ru" ? "ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´ Ğ² Ğ¼ĞµĞ½Ñ" : (lang === "hi" ? "ğŸ”™ à¤®à¥‡à¤¨à¥‚ à¤ªà¤° à¤µà¤¾à¤ªà¤¸ à¤œà¤¾à¤à¤‚" : (lang === "zh" ? "ğŸ”™ è¿”å›èœå•" : (lang === "ar" ? "ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©" : "ğŸ”™ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹"))))), command: "/start" }]
];

Bot.sendInlineKeyboard(keyboard, messages[lang].nextAction);
