var lang = User.getProperty("language") || "en"; // ðŸŒ Obtener el idioma del usuario, predeterminado a inglÃ©s

// Mensajes en diferentes idiomas
var messages = {
    en: {
        notRegistered: "âš ï¸ First, you must register using /register.",
        pointsGained: "âœ… You have earned %d points! ðŸŽ‰\n\nWhat would you like to do next?", // Usar %d para los puntos
        waitTime: "âš ï¸ You must wait %d more seconds before confirming the visit.",
        noActiveVisit: "âŒ You have no active visit. Use /visitlink to start one.",
        backToMenu: "ðŸ”™ Back to Menu",
        visitAnotherLink: "ðŸ”— Visit another link"
    },
    es: {
        notRegistered: "âš ï¸ Primero debes registrarte usando /register.",
        pointsGained: "âœ… Â¡Has ganado %d puntos! ðŸŽ‰\n\nÂ¿QuÃ© te gustarÃ­a hacer a continuaciÃ³n?", // Usar %d para los puntos
        waitTime: "âš ï¸ Debes esperar %d segundos mÃ¡s antes de confirmar la visita.",
        noActiveVisit: "âŒ No tienes ninguna visita en curso. Usa /visitlink para comenzar una.",
        backToMenu: "ðŸ”™ Volver al MenÃº",
        visitAnotherLink: "ðŸ”— Visitar otro enlace"
    },
    ru: {
        notRegistered: "âš ï¸ Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐ¹Ñ‚ÐµÑÑŒ, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑ /register.",
        pointsGained: "âœ… Ð’Ñ‹ Ð·Ð°Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð»Ð¸ %d Ð¾Ñ‡ÐºÐ¾Ð²! ðŸŽ‰\n\nÐ§Ñ‚Ð¾ Ð±Ñ‹ Ð²Ñ‹ Ñ…Ð¾Ñ‚ÐµÐ»Ð¸ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð´Ð°Ð»ÑŒÑˆÐµ?", // Usar %d para los puntos
        waitTime: "âš ï¸ Ð’Ð°Ð¼ Ð½ÑƒÐ¶Ð½Ð¾ Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð°Ñ‚ÑŒ ÐµÑ‰Ðµ %d ÑÐµÐºÑƒÐ½Ð´ Ð¿ÐµÑ€ÐµÐ´ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸ÐµÐ¼ Ð²Ð¸Ð·Ð¸Ñ‚Ð°.",
        noActiveVisit: "âŒ Ð£ Ð²Ð°Ñ Ð½ÐµÑ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾Ð³Ð¾ Ð²Ð¸Ð·Ð¸Ñ‚Ð°. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ /visitlink, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ.",
        backToMenu: "ðŸ”™ Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ð² Ð¼ÐµÐ½ÑŽ",
        visitAnotherLink: "ðŸ”— ÐŸÐ¾ÑÐµÑ‚Ð¸Ñ‚ÑŒ Ð´Ñ€ÑƒÐ³ÑƒÑŽ ÑÑÑ‹Ð»ÐºÑƒ"
    },
    hi: { // Hindi ðŸ‡®ðŸ‡³
        notRegistered: "âš ï¸ à¤ªà¤¹à¤²à¥‡ /register à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¤•à¥‡ à¤ªà¤‚à¤œà¥€à¤•à¤°à¤£ à¤•à¤°à¥‡à¤‚à¥¤",
        pointsGained: "âœ… à¤†à¤ªà¤¨à¥‡ %d à¤…à¤‚à¤• à¤…à¤°à¥à¤œà¤¿à¤¤ à¤•à¤¿à¤ à¤¹à¥ˆà¤‚! ðŸŽ‰\n\nà¤…à¤¬ à¤†à¤ª à¤†à¤—à¥‡ à¤•à¥à¤¯à¤¾ à¤•à¤°à¤¨à¤¾ à¤šà¤¾à¤¹à¥‡à¤‚à¤—à¥‡?", // Usar %d para los puntos
        waitTime: "âš ï¸ à¤†à¤ªà¤•à¥‹ à¤ªà¥à¤·à¥à¤Ÿà¤¿ à¤•à¤°à¤¨à¥‡ à¤¸à¥‡ à¤ªà¤¹à¤²à¥‡ %d à¤”à¤° à¤¸à¥‡à¤•à¤‚à¤¡ à¤‡à¤‚à¤¤à¤œà¤¾à¤° à¤•à¤°à¤¨à¤¾ à¤¹à¥‹à¤—à¤¾à¥¤",
        noActiveVisit: "âŒ à¤†à¤ªà¤•à¥‡ à¤ªà¤¾à¤¸ à¤•à¥‹à¤ˆ à¤¸à¤•à¥à¤°à¤¿à¤¯ à¤µà¤¿à¤œà¤¼à¤¿à¤Ÿ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤ à¤¶à¥à¤°à¥‚ à¤•à¤°à¤¨à¥‡ à¤•à¥‡ à¤²à¤¿à¤ /visitlink à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¥‡à¤‚à¥¤",
        backToMenu: "ðŸ”™ à¤®à¥‡à¤¨à¥‚ à¤ªà¤° à¤µà¤¾à¤ªà¤¸ à¤œà¤¾à¤à¤‚",
        visitAnotherLink: "ðŸ”— à¤¦à¥‚à¤¸à¤°à¤¾ à¤²à¤¿à¤‚à¤• à¤¦à¥‡à¤–à¥‡à¤‚"
    },
    zh: { // Chino Simplificado ðŸ‡¨ðŸ‡³
        notRegistered: "âš ï¸ é¦–å…ˆï¼Œæ‚¨å¿…é¡»ä½¿ç”¨ /register æ³¨å†Œã€‚",
        pointsGained: "âœ… æ‚¨èŽ·å¾—äº† %d åˆ†ï¼ ðŸŽ‰\n\næŽ¥ä¸‹æ¥æ‚¨æƒ³åšä»€ä¹ˆï¼Ÿ", // Usar %d para los puntos
        waitTime: "âš ï¸ æ‚¨å¿…é¡»ç­‰å¾… %d ç§’åŽæ‰èƒ½ç¡®è®¤è®¿é—®ã€‚",
        noActiveVisit: "âŒ æ‚¨æ²¡æœ‰ä»»ä½•æ´»åŠ¨è®¿é—®ã€‚è¯·ä½¿ç”¨ /visitlink å¼€å§‹ã€‚",
        backToMenu: "ðŸ”™ è¿”å›žèœå•",
        visitAnotherLink: "ðŸ”— è®¿é—®å¦ä¸€ä¸ªé“¾æŽ¥"
    },
    ja: { // JaponÃ©s ðŸ‡¯ðŸ‡µ
        notRegistered: "âš ï¸ æœ€åˆã« /register ã‚’ä½¿ç”¨ã—ã¦ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚",
        pointsGained: "âœ… %d ãƒã‚¤ãƒ³ãƒˆã‚’ç²å¾—ã—ã¾ã—ãŸï¼ ðŸŽ‰\n\næ¬¡ã«ä½•ã‚’ã—ãŸã„ã§ã™ã‹ï¼Ÿ", // Usar %d para los puntos
        waitTime: "âš ï¸ è¨ªå•ã‚’ç¢ºèªã™ã‚‹å‰ã« %d ç§’å¾…ã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚",
        noActiveVisit: "âŒ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªè¨ªå•ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚/visitlink ã‚’ä½¿ç”¨ã—ã¦é–‹å§‹ã—ã¦ãã ã•ã„ã€‚",
        backToMenu: "ðŸ”™ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹",
        visitAnotherLink: "ðŸ”— åˆ¥ã®ãƒªãƒ³ã‚¯ã‚’è¨ªå•ã™ã‚‹"
    },
    ar: { // Ãrabe ðŸ‡¸ðŸ‡¦
        notRegistered: "âš ï¸ Ø£ÙˆÙ„Ø§Ù‹ØŒ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… /register.",
        pointsGained: "âœ… Ù„Ù‚Ø¯ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ %d Ù†Ù‚Ø§Ø·! ðŸŽ‰\n\nÙ…Ø§Ø°Ø§ ØªØ±ØºØ¨ ÙÙŠ ÙØ¹Ù„Ù‡ Ø¨Ø¹Ø¯ Ø°Ù„ÙƒØŸ", // Usar %d para los puntos
        waitTime: "âš ï¸ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± %d Ø«Ø§Ù†ÙŠØ© Ø£Ø®Ø±Ù‰ Ù‚Ø¨Ù„ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø©.",
        noActiveVisit: "âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø²ÙŠØ§Ø±Ø© Ù†Ø´Ø·Ø©. Ø§Ø³ØªØ®Ø¯Ù… /visitlink Ù„Ø¨Ø¯Ø¡ Ø²ÙŠØ§Ø±Ø©.",
        backToMenu: "ðŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©",
        visitAnotherLink: "ðŸ”— Ø²ÙŠØ§Ø±Ø© Ø±Ø§Ø¨Ø· Ø¢Ø®Ø±"
    }
};

var visitorData = Bot.getProperty("user_" + user.telegramid);
if (!visitorData) {
    Bot.sendMessage(messages[lang].notRegistered);
    return;
}

// Verificar si el usuario tiene una visita activa
if (!User.getProperty("visit_in_progress")) {
    Bot.sendMessage(messages[lang].noActiveVisit);
    return;
}

// Validar el tiempo de espera (10 segundos)
var visitTime = User.getProperty("visit_time");
var currentTime = new Date().getTime();
var requiredWaitTime = 10000; // 10 segundos

if (currentTime - visitTime >= requiredWaitTime) { // Ganar 10 puntos fijos al confirmar la visita
    var earnedPoints = 10; // Fijo a 10 puntos
    visitorData.points = (visitorData.points || 0) + earnedPoints; // Sumar puntos
    Bot.setProperty("user_" + user.telegramid, visitorData, "json");

    var keyboard = [  
        [{ title: messages[lang].backToMenu, command: "/start" }],  
        [{ title: messages[lang].visitAnotherLink, command: "/visitlink" }]  
    ];  

    Bot.sendInlineKeyboard(keyboard, messages[lang].pointsGained.replace("%d", earnedPoints)); // Mostrar puntos ganados  

    // Resetear propiedades de visita  
    User.setProperty("visit_in_progress", false, "boolean");

} else {
    var remainingTime = Math.ceil((requiredWaitTime - (currentTime - visitTime)) / 1000);
    Bot.sendMessage(messages[lang].waitTime.replace("%d", remainingTime));
}
