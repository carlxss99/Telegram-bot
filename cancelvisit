// /cancelvisit
var lang = User.getProperty("language") || "en"; // Idioma predeterminado: espaÃ±ol

var messages = {
  es: {
    noVisit: "âŒ No tienes ninguna visita en progreso.",
    visitCancelled: "ğŸš« Visita cancelada.",
    backToMenu: "â¬…ï¸ Volver al MenÃº"
  },
  en: {
    noVisit: "âŒ You don't have any visit in progress.",
    visitCancelled: "ğŸš« Visit cancelled.",
    backToMenu: "â¬…ï¸ Back to Menu"
  },
  ru: {
    noVisit: "âŒ Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾ÑĞµÑ‰ĞµĞ½Ğ¸Ñ.",
    visitCancelled: "ğŸš« ĞŸĞ¾ÑĞµÑ‰ĞµĞ½Ğ¸Ğµ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ¾.",
    backToMenu: "â¬…ï¸ Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ Ğ² Ğ¼ĞµĞ½Ñ"
  },
  hi: {
    noVisit: "âŒ à¤†à¤ªà¤•à¥€ à¤•à¥‹à¤ˆ à¤¯à¤¾à¤¤à¥à¤°à¤¾ à¤ªà¥à¤°à¤—à¤¤à¤¿ à¤®à¥‡à¤‚ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤",
    visitCancelled: "ğŸš« à¤¯à¤¾à¤¤à¥à¤°à¤¾ à¤°à¤¦à¥à¤¦ à¤•à¤° à¤¦à¥€ à¤—à¤ˆà¥¤",
    backToMenu: "â¬…ï¸ à¤®à¥‡à¤¨à¥‚ à¤ªà¤° à¤µà¤¾à¤ªà¤¸ à¤œà¤¾à¤à¤‚"
  },
  zh: {
    noVisit: "âŒ ä½ æ²¡æœ‰æ­£åœ¨è¿›è¡Œçš„è®¿é—®ã€‚",
    visitCancelled: "ğŸš« è®¿é—®å·²å–æ¶ˆã€‚",
    backToMenu: "â¬…ï¸ è¿”å›èœå•"
  },
  ja: {
    noVisit: "âŒ é€²è¡Œä¸­ã®è¨ªå•ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
    visitCancelled: "ğŸš« è¨ªå•ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚",
    backToMenu: "â¬…ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹"
  },
  ar: {
    noVisit: "âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø²ÙŠØ§Ø±Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯Ù….",
    visitCancelled: "ğŸš« ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø²ÙŠØ§Ø±Ø©.",
    backToMenu: "â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©"
  }
};

var visitInProgress = User.getProperty("visit_in_progress");
if (!visitInProgress) {
  Bot.sendMessage(messages[lang].noVisit);
  return;
}

// Cancelar la visita: se desactiva la bandera y se "limpian" las propiedades relacionadas
User.setProperty("visit_in_progress", false, "boolean");
User.setProperty("visit_target", "", "string");
User.setProperty("visit_username", "", "string");
User.setProperty("visit_link", "", "string");
User.setProperty("visit_time", 0, "number");

var keyboard = [
  [{ title: messages[lang].backToMenu, command: "/start" }]
];

Bot.sendInlineKeyboard(keyboard, messages[lang].visitCancelled);
