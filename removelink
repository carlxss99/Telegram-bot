// Detectar el idioma del usuario
var userLang = User.getProperty("language");
if (!userLang) {
  userLang = request.language_code ? request.language_code.substring(0, 2).toLowerCase() : "en";
  if (["es", "en", "ru", "hi", "zh", "ja", "ar"].indexOf(userLang) === -1) {
    userLang = "es";
  }
  User.setProperty("language", userLang, "string");
}

// Mensajes en diferentes idiomas con emojis ğŸ¯
var messages = {
  es: {
    notRegistered: "âš ï¸ Primero debes registrarte usando /register.",
    noLinks: "ğŸš« No tienes enlaces agregados.",
    selectLink: "ğŸ—‘ï¸ Selecciona el nÃºmero del enlace que deseas eliminar:",
    links: "ğŸ”— Tus enlaces agregados:\n"
  },
  en: {
    notRegistered: "âš ï¸ First, you need to register using /register.",
    noLinks: "ğŸš« You have no links added.",
    selectLink: "ğŸ—‘ï¸ Select the number of the link you want to delete:",
    links: "ğŸ”— Your added links:\n"
  },
  ru: {
    notRegistered: "âš ï¸ Ğ¡Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞ¹Ñ‚ĞµÑÑŒ, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ /register.",
    noLinks: "ğŸš« Ğ£ Ğ²Ğ°Ñ Ğ½ĞµÑ‚ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ñ… ÑÑÑ‹Ğ»Ğ¾Ğº.",
    selectLink: "ğŸ—‘ï¸ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ¼ĞµÑ€ ÑÑÑ‹Ğ»ĞºĞ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€ÑƒÑ Ñ…Ğ¾Ñ‚Ğ¸Ñ‚Ğµ ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ:",
    links: "ğŸ”— Ğ’Ğ°ÑˆĞ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ ÑÑÑ‹Ğ»ĞºĞ¸:\n"
  },
  hi: { // Hindi
    notRegistered: "âš ï¸ à¤ªà¤¹à¤²à¥‡ à¤†à¤ªà¤•à¥‹ /register à¤•à¤¾ à¤‰à¤ªà¤¯à¥‹à¤— à¤•à¤°à¤•à¥‡ à¤ªà¤‚à¤œà¥€à¤•à¤°à¤£ à¤•à¤°à¤¨à¤¾ à¤¹à¥‹à¤—à¤¾à¥¤",
    noLinks: "ğŸš« à¤†à¤ªà¤•à¥‡ à¤ªà¤¾à¤¸ à¤•à¥‹à¤ˆ à¤²à¤¿à¤‚à¤• à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤",
    selectLink: "ğŸ—‘ï¸ à¤‰à¤¸ à¤²à¤¿à¤‚à¤• à¤•à¥€ à¤¸à¤‚à¤–à¥à¤¯à¤¾ à¤šà¥à¤¨à¥‡à¤‚ à¤œà¤¿à¤¸à¥‡ à¤†à¤ª à¤¹à¤Ÿà¤¾à¤¨à¤¾ à¤šà¤¾à¤¹à¤¤à¥‡ à¤¹à¥ˆà¤‚:",
    links: "ğŸ”— à¤†à¤ªà¤•à¥‡ à¤œà¥‹à¤¡à¤¼à¥‡ à¤—à¤ à¤²à¤¿à¤‚à¤•:\n"
  },
  zh: { // Chino simplificado
    notRegistered: "âš ï¸ é¦–å…ˆï¼Œæ‚¨éœ€è¦ä½¿ç”¨ /register è¿›è¡Œæ³¨å†Œã€‚",
    noLinks: "ğŸš« æ‚¨æ²¡æœ‰æ·»åŠ ä»»ä½•é“¾æ¥ã€‚",
    selectLink: "ğŸ—‘ï¸ é€‰æ‹©è¦åˆ é™¤çš„é“¾æ¥ç¼–å·ï¼š",
    links: "ğŸ”— æ‚¨å·²æ·»åŠ çš„é“¾æ¥ï¼š\n"
  },
  ja: { // JaponÃ©s
    notRegistered: "âš ï¸ ã¾ãšã€/register ã‚’ä½¿ç”¨ã—ã¦ç™»éŒ²ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚",
    noLinks: "ğŸš« è¿½åŠ ã•ã‚ŒãŸãƒªãƒ³ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚",
    selectLink: "ğŸ—‘ï¸ å‰Šé™¤ã—ãŸã„ãƒªãƒ³ã‚¯ã®ç•ªå·ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š",
    links: "ğŸ”— ã‚ãªãŸã®è¿½åŠ ã—ãŸãƒªãƒ³ã‚¯ï¼š\n"
  },
  ar: { // Ãrabe
    notRegistered: "âš ï¸ Ø£ÙˆÙ„Ø§Ù‹ØŒ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… /register.",
    noLinks: "ğŸš« Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø±ÙˆØ§Ø¨Ø· Ù…Ø¶Ø§ÙØ©.",
    selectLink: "ğŸ—‘ï¸ Ø­Ø¯Ø¯ Ø±Ù‚Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯ Ø­Ø°ÙÙ‡:",
    links: "ğŸ”— Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø¶Ø§ÙØ© Ù„Ø¯ÙŠÙƒ:\n"
  }
};

// Ejecutar el cÃ³digo del comando
try {
  var userData = Bot.getProperty("user_" + user.telegramid) || { links: [] };

  // Comprobar si el usuario estÃ¡ registrado
  if (!userData.username) {
    Bot.sendMessage(messages[userLang].notRegistered);
    return;
  }

  // Comprobar si el usuario tiene enlaces agregados
  if (userData.links.length === 0) {
    Bot.sendMessage(messages[userLang].noLinks);
    return;
  }

  // Crear el mensaje con los enlaces
  var linksMessage = messages[userLang].links;
  var keyboard = [];

  for (var i = 0; i < userData.links.length; i++) {
    linksMessage += "ğŸ“Œ " + (i + 1) + ": " + userData.links[i] + "\n";
    keyboard.push([{ title: "âŒ " + (i + 1).toString(), command: "/removelinkconfirm " + (i + 1) }]); // BotÃ³n para cada enlace
  }

  Bot.sendInlineKeyboard(keyboard, linksMessage + "\n" + messages[userLang].selectLink); // Enviar el mensaje y los botones

} catch (error) {
  Bot.sendMessage("âŒ OcurriÃ³ un error inesperado: " + error.message);
  console.error("Error inesperado:", error); // Esto lo imprimirÃ¡ en la consola
}
