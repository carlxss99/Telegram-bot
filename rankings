function sendRankingMessage() {
    var lang = User.getProperty("language") || "en"; // ğŸŒ Idioma predeterminado

    var messages = {
        en: {
            noUsers: "âŒ No registered users yet.",
            rankingHeader: "ğŸ† TOP 10 Users of the Week:",
            nextAction: "âš¡ What do you want to do next?",
            invite: "ğŸ“¢ Invite your friends and climb the ranks!",
            backToMenu: "ğŸ”™ Back to Menu",
            myPoints: "ğŸ“Š My Points",
            link: "ğŸ”— Referral Link:",
            points: "points"
        },
        es: {
            noUsers: "âŒ No hay usuarios registrados aÃºn.",
            rankingHeader: "ğŸ† TOP 10 Usuarios de la Semana:",
            nextAction: "âš¡ Â¿QuÃ© te gustarÃ­a hacer a continuaciÃ³n?",
            invite: "ğŸ“¢ Â¡Invita a tus amigos y sube en el ranking!",
            backToMenu: "ğŸ”™ Volver al MenÃº",
            myPoints: "ğŸ“Š Mis Puntos",
            link: "ğŸ”— Enlace de referido:",
            points: "puntos"
        },
        ru: {
            noUsers: "âŒ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ ĞµÑ‰Ğµ Ğ½Ğµ Ğ·Ğ°Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ñ‹.",
            rankingHeader: "ğŸ† Ğ¢ĞĞŸ 10 Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ½ĞµĞ´ĞµĞ»Ğ¸:",
            nextAction: "âš¡ Ğ§Ñ‚Ğ¾ Ğ±Ñ‹ Ğ²Ñ‹ Ñ…Ğ¾Ñ‚ĞµĞ»Ğ¸ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ´Ğ°Ğ»ÑŒÑˆĞµ?",
            invite: "ğŸ“¢ ĞŸÑ€Ğ¸Ğ³Ğ»Ğ°ÑĞ¸Ñ‚Ğµ ÑĞ²Ğ¾Ğ¸Ñ… Ğ´Ñ€ÑƒĞ·ĞµĞ¹ Ğ¸ Ğ¿Ğ¾Ğ´Ğ½Ğ¸Ğ¼Ğ¸Ñ‚ĞµÑÑŒ Ğ² Ñ€ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³Ğµ!",
            backToMenu: "ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´ Ğ² Ğ¼ĞµĞ½Ñ",
            myPoints: "ğŸ“Š ĞœĞ¾Ğ¸ Ğ¾Ñ‡ĞºĞ¸",
            link: "ğŸ”— Ğ ĞµÑ„ĞµÑ€Ğ°Ğ»ÑŒĞ½Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ°:",
            points: "Ğ¾Ñ‡ĞºĞ¾Ğ²"
        },
        hi: {  
            noUsers: "âŒ à¤…à¤­à¥€ à¤¤à¤• à¤•à¥‹à¤ˆ à¤ªà¤‚à¤œà¥€à¤•à¥ƒà¤¤ à¤‰à¤ªà¤¯à¥‹à¤—à¤•à¤°à¥à¤¤à¤¾ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤",
            rankingHeader: "ğŸ† à¤‡à¤¸ à¤¸à¤ªà¥à¤¤à¤¾à¤¹ à¤•à¥‡ TOP 10 à¤‰à¤ªà¤¯à¥‹à¤—à¤•à¤°à¥à¤¤à¤¾:",
            nextAction: "âš¡ à¤…à¤—à¤²à¤¾ à¤•à¤¦à¤® à¤•à¥à¤¯à¤¾ à¤¹à¥‹à¤—à¤¾?",
            invite: "ğŸ“¢ à¤…à¤ªà¤¨à¥‡ à¤¦à¥‹à¤¸à¥à¤¤à¥‹à¤‚ à¤•à¥‹ à¤†à¤®à¤‚à¤¤à¥à¤°à¤¿à¤¤ à¤•à¤°à¥‡à¤‚ à¤”à¤° à¤°à¥ˆà¤‚à¤• à¤®à¥‡à¤‚ à¤šà¤¢à¤¼à¥‡à¤‚!",
            backToMenu: "ğŸ”™ à¤®à¥‡à¤¨à¥‚ à¤®à¥‡à¤‚ à¤µà¤¾à¤ªà¤¸ à¤œà¤¾à¤à¤‚",
            myPoints: "ğŸ“Š à¤®à¥‡à¤°à¥‡ à¤…à¤‚à¤•",
            link: "ğŸ”— à¤¸à¤‚à¤¦à¤°à¥à¤­ à¤²à¤¿à¤‚à¤•:",
            points: "à¤…à¤‚à¤•"
        },
        zh: {  
            noUsers: "âŒ ç›®å‰è¿˜æ²¡æœ‰æ³¨å†Œç”¨æˆ·ã€‚",
            rankingHeader: "ğŸ† æœ¬å‘¨å‰ 10 åç”¨æˆ·:",
            nextAction: "âš¡ æ¥ä¸‹æ¥ä½ æƒ³åšä»€ä¹ˆï¼Ÿ",
            invite: "ğŸ“¢ é‚€è¯·ä½ çš„æœ‹å‹å¹¶æå‡æ’åï¼",
            backToMenu: "ğŸ”™ è¿”å›èœå•",
            myPoints: "ğŸ“Š æˆ‘çš„ç§¯åˆ†",
            link: "ğŸ”— æ¨èé“¾æ¥:",
            points: "ç§¯åˆ†"
        },
        ja: {  
            noUsers: "âŒ ã¾ã ç™»éŒ²ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã„ã¾ã›ã‚“ã€‚",
            rankingHeader: "ğŸ† ä»Šé€±ã®ãƒˆãƒƒãƒ—10ãƒ¦ãƒ¼ã‚¶ãƒ¼:",
            nextAction: "âš¡ æ¬¡ã«ä½•ã‚’ã—ã¾ã™ã‹ï¼Ÿ",
            invite: "ğŸ“¢ å‹é”ã‚’æ‹›å¾…ã—ã¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ä¸Šã’ã‚ˆã†ï¼",
            backToMenu: "ğŸ”™ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹",
            myPoints: "ğŸ“Š è‡ªåˆ†ã®ãƒã‚¤ãƒ³ãƒˆ",
            link: "ğŸ”— ç´¹ä»‹ãƒªãƒ³ã‚¯:",
            points: "ãƒã‚¤ãƒ³ãƒˆ"
        },
        ar: {  
            noUsers: "âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ù…Ø³Ø¬Ù„ÙˆÙ† Ø¨Ø¹Ø¯.",
            rankingHeader: "ğŸ† Ø£ÙØ¶Ù„ 10 Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù„Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:",
            nextAction: "âš¡ Ù…Ø§Ø°Ø§ ØªØ±ÙŠØ¯ Ø£Ù† ØªÙØ¹Ù„ Ø¨Ø¹Ø¯ Ø°Ù„ÙƒØŸ",
            invite: "ğŸ“¢ Ù‚Ù… Ø¨Ø¯Ø¹ÙˆØ© Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ ÙˆØªØ³Ù„Ù‚ Ø§Ù„ØªØ±ØªÙŠØ¨!",
            backToMenu: "ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©",
            myPoints: "ğŸ“Š Ù†Ù‚Ø§Ø·ÙŠ",
            link: "ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©:",
            points: "Ù†Ù‚Ø§Ø·"
        }
    };

    var allUsers = Bot.getProperty("all_users") || [];

    if (!Array.isArray(allUsers) || allUsers.length === 0) {
        Bot.sendMessage(messages[lang].noUsers);
        return;
    }

    var ranking = [];

    for (var i = 0; i < allUsers.length; i++) {
        var uid = allUsers[i];
        var userData = Bot.getProperty("user_" + uid);

        if (userData) {
            ranking.push({
                id: uid,
                username: userData.username ? userData.username.replace(/<[^>]*>/g, "") : "ğŸ‘¤ Unknown User",
                points: userData.points || 0,
                links: userData.links || []
            });
        } else {
            ranking.push({
                id: uid,
                username: "ğŸ‘¤ Usuario no reconocido",
                points: 0,
                links: []
            });
        }
    }

    if (ranking.length === 0) {
        Bot.sendMessage(messages[lang].noUsers);
        return;
    }

    ranking.sort((a, b) => b.points - a.points);
    var topRanking = ranking.slice(0, 10);

    // ğŸ–ï¸ ConstrucciÃ³n del mensaje del ranking
    var rankingMessage = messages[lang].invite + "\n\n" + messages[lang].rankingHeader + "\n\n";

    for (var j = 0; j < topRanking.length; j++) {
        var randomLink = topRanking[j].links.length > 0
            ? topRanking[j].links[Math.floor(Math.random() * topRanking[j].links.length)]
            : "ğŸš« No Link";

        rankingMessage += "ğŸ”¹ " + (j + 1) + ". " + topRanking[j].username + " â­ï¸ - " + topRanking[j].points + " " + messages[lang].points + "\n";
        rankingMessage += messages[lang].link + " " + (randomLink !== "ğŸš« No Link"
            ? '<a href="' + randomLink + '">ğŸ”— ' + randomLink + '</a>'
            : randomLink) + "\n\n";
    }

    rankingMessage += "--------------------------------------------\n";
    rankingMessage += messages[lang].nextAction + "\n"; // ğŸŸ¢ Mensaje final

    var keyboard = [
        [{ title: messages[lang].backToMenu, command: "/start" }],
        [{ title: messages[lang].myPoints, command: "/checkpoints" }]
    ];

    Bot.sendInlineKeyboard(keyboard, rankingMessage, { parse_mode: "HTML" });
}

sendRankingMessage();
